{"version":3,"file":"the-watermark.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;UCVA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;;AAEN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;;AAErB;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,+DAA+D,aAAa,GAAG;AAC/E;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://the-watermark/webpack/universalModuleDefinition","webpack://the-watermark/webpack/bootstrap","webpack://the-watermark/webpack/runtime/define property getters","webpack://the-watermark/webpack/runtime/hasOwnProperty shorthand","webpack://the-watermark/webpack/runtime/make namespace object","webpack://the-watermark/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * new Watermark({\n *  container: body,\n *  content: 'watermark',\n *  width: 300,\n *  height: 200,\n *  zIndex: 1000,\n *  font: \"28px auto\",\n *  textAlign: 'center',\n *  textBaseline: 'middle',\n *  color: 'rgba(0, 0, 0, 0.2)',\n *  rotate: -34,\n * })\n */\nexport class Watermark {\n\n  config = {\n    container: null,\n    content: 'watermark',\n    width: 300,\n    height: 200,\n    zIndex: 1000,\n    font: \"28px auto\",\n    textAlign: 'center',\n    textBaseline: 'middle',\n    color: 'rgba(0, 0, 0, 0.2)',\n    rotate: -34,\n  }\n\n  container = null;\n  isFixed = false;\n  dataUrl = void 0;\n  styleString = '';\n  wm = void 0;\n  observer = void 0;\n\n  constructor(config = {}) {\n    this.config = {\n      ...this.config,\n      ...config,\n    }\n    this.container = this.config.container;\n\n    this.setContainer();\n    this.generateDataUrl();\n    this.generateStyleString();\n    this.generateWatermark();\n    this.observerContainer();\n  }\n\n  // 设置水印容器\n  setContainer() {\n    if (!this.container) {\n      this.container = document.querySelector('body');\n      this.isFixed = true;\n    }\n\n    if (\n      !this.isFixed &&\n      !['absolute', 'relative', 'fixed'].includes(this.container.style.position)\n    ) {\n      this.container.style.position = 'relative';\n    }\n  }\n\n  // 使用 canvas 生成水印图片，并转为 dataUrl\n  generateDataUrl() {\n    const {\n      width,\n      height,\n      font,\n      textAlign,\n      textBaseline,\n      color,\n      rotate,\n      content,\n    } = this.config;\n\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('width', width);\n    canvas.setAttribute('height', height);\n  \n    const ctx = canvas.getContext('2d');\n    ctx.font = font;\n    ctx.textAlign = textAlign;\n    ctx.textBaseline = textBaseline;\n    ctx.fillStyle = color;\n    ctx.translate(parseFloat(width) / 2, parseFloat(height) / 2);\n    ctx.rotate(Math.PI / 180 * rotate);\n    ctx.fillText(content, 0, 0);\n  \n    this.dataUrl = canvas.toDataURL();\n  }\n\n  // 根据配置及 dataUrl 生成一个 style 字符串，用于注入到水印 dom 节点中\n  generateStyleString() {\n    const { zIndex } = this.config;\n\n    this.styleString = \n    (`\n      position: ${this.isFixed ? 'fixed' : 'absolute'};\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: ${zIndex};\n      pointer-events:none;\n      background-repeat:repeat;\n    `)\n    .replaceAll(/[\\n]|[\\ +]/g, '') + `background-image: url(\"${this.dataUrl}\");`;\n  }\n\n  // 生成水印 dom 节点，并 append 到容器中\n  generateWatermark() {\n    this.wm = document.createElement('div');\n    this.wm.setAttribute('style', this.styleString);\n    this.wm.setAttribute('class', '_watermark');\n    this.container.appendChild(this.wm);\n  }\n\n  /**\n   * 监听容器节点变化，若\n   * 1. 水印节点被删掉\n   * 2. 水印节点的 style 改变\n   * 那么，重新生成水印，以防用户对水印作出修改\n   */\n  observerContainer() {\n    const MutationObserver = window.MutationObserver;\n    if (MutationObserver) {\n      this.observer = new MutationObserver(\n        () => {\n          const _watermark = document.querySelector('._watermark');\n          if (\n            !_watermark ||\n            _watermark && _watermark.getAttribute('style') !== styleString\n          ) {\n            this.hidden();\n            const newWm = new Watermark(this.config);\n            this.hidden = () => {\n              newWm.hidden();\n            }\n          }\n        }\n      );\n  \n      this.observer.observe(\n        this.container,\n        {\n          childList: true,\n          attributes: true,\n          subtree: true,\n        }\n      );\n    }\n  }\n\n  // 移除水印\n  hidden() {\n    this.observer && this.observer.disconnect();\n    this.observer = null;\n    this.wm && this.wm.remove && this.wm.remove();\n  }\n}\n"],"names":[],"sourceRoot":""}