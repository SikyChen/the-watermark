{"version":3,"file":"the-watermark.min.js","mappings":"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","sources":["webpack://Watermark/webpack/universalModuleDefinition","webpack://Watermark/webpack/bootstrap","webpack://Watermark/webpack/runtime/define property getters","webpack://Watermark/webpack/runtime/hasOwnProperty shorthand","webpack://Watermark/./src/index.js","webpack://Watermark/./src/utils.js","webpack://Watermark/./index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Watermark\"] = factory();\n\telse\n\t\troot[\"Watermark\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { getWatermarkByContainer, isConfigEqual } from \"./utils\";\n\n/**\n * new Watermark({\n *  container: body,\n *  content: 'watermark',\n *  width: 300,\n *  height: 200,\n *  zIndex: 1000,\n *  font: \"28px auto\",\n *  textAlign: 'center',\n *  textBaseline: 'middle',\n *  color: 'rgba(200, 200, 200, 0.2)',\n *  rotate: -34,\n * })\n */\nexport default class Watermark {\n\n  config = {\n    container: null,\n    content: 'watermark',\n    width: 300,\n    height: 200,\n    zIndex: 1000,\n    font: \"28px auto\",\n    textAlign: 'center',\n    textBaseline: 'middle',\n    color: 'rgba(200, 200, 200, 0.2)',\n    rotate: -34,\n  }\n\n  container = null;\n  isFixed = false;\n  dataUrl = void 0;\n  styleString = '';\n  wm = void 0;\n  observer = void 0;\n\n  constructor(config = {}) {\n    this.config = {\n      ...this.config,\n      ...config,\n    }\n\n    this.setContainer(this.config.container);\n\n    try {\n      if (\n        this.container._watermarkInstance &&\n        isConfigEqual(this.container._watermarkInstance.config, this.config)\n      ) {\n        return this.container._watermarkInstance;\n      } else {\n        this.container._watermarkInstance = this;\n      }\n    } catch (error) {\n      console.log('Please enter the correct configs.', error);\n    }\n\n    this.init();\n  }\n\n  // 设置水印容器\n  setContainer(container) {\n    if (container) {\n      this.container = container;\n      if (!['absolute', 'relative', 'fixed'].includes(this.container.style.position)) {\n        this.container.style.position = 'relative';\n      }\n    }\n    else {\n      this.container = document.querySelector('body');\n      this.isFixed = true;\n    }\n  }\n\n  init() {\n    this.generateDataUrl();\n    this.generateStyleString();\n    this.generateWatermark();\n    this.observerContainer();\n  }\n\n  // 使用 canvas 生成水印图片，并转为 dataUrl\n  generateDataUrl() {\n    const {\n      width,\n      height,\n      font,\n      textAlign,\n      textBaseline,\n      color,\n      rotate,\n      content,\n    } = this.config;\n\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('width', width);\n    canvas.setAttribute('height', height);\n  \n    const ctx = canvas.getContext('2d');\n    ctx.font = font;\n    ctx.textAlign = textAlign;\n    ctx.textBaseline = textBaseline;\n    ctx.fillStyle = color;\n    ctx.translate(parseFloat(width) / 2, parseFloat(height) / 2);\n    ctx.rotate(Math.PI / 180 * rotate);\n    ctx.fillText(content, 0, 0);\n  \n    this.dataUrl = canvas.toDataURL();\n  }\n\n  // 根据配置及 dataUrl 生成一个 style 字符串，用于注入到水印 dom 节点中\n  generateStyleString() {\n    const { zIndex } = this.config;\n\n    this.styleString = \n    (`\n      position: ${this.isFixed ? 'fixed' : 'absolute'};\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: ${zIndex};\n      pointer-events:none;\n      background-repeat:repeat;\n    `)\n    .replaceAll(/[\\n]|[\\ +]/g, '') + `background-image: url(\"${this.dataUrl}\");`;\n  }\n\n  // 生成水印 dom 节点，并 append 到容器中\n  generateWatermark() {\n    this.wm = document.createElement('div');\n    this.wm.setAttribute('style', this.styleString);\n    this.wm.setAttribute('class', '_watermark');\n    this.container.appendChild(this.wm);\n  }\n\n  /**\n   * 监听容器节点变化，若\n   * 1. 水印节点被删掉\n   * 2. 水印节点的 style 改变\n   * 那么，重新生成水印，以防用户对水印作出修改\n   */\n  observerContainer() {\n    const MutationObserver = window.MutationObserver;\n    if (MutationObserver) {\n      this.observer = new MutationObserver(\n        () => {\n          const _watermark = getWatermarkByContainer(this.container);\n          if (\n            !_watermark ||\n            _watermark && _watermark.getAttribute('style') !== this.styleString\n          ) {\n            this.hidden();\n            const newWm = new Watermark(this.config);\n            this.hidden = () => {\n              newWm.hidden();\n            }\n          }\n        }\n      );\n  \n      this.observer.observe(\n        this.container,\n        {\n          childList: true,\n          attributes: true,\n          subtree: true,\n        }\n      );\n    }\n  }\n\n  /**\n   * 移除水印\n   */\n  hidden() {\n    this.observer && this.observer.disconnect();\n    this.observer = null;\n    this.wm && this.wm.remove && this.wm.remove();\n    this.container._watermarkInstance = null;\n  }\n}\n","/**\n * 比较两次的 config 配置是否相同\n * @param {Object} config \n * @param {Object} other \n * @returns Boolean\n */\nexport const isConfigEqual = (config, other) => {\n\n\tif (config === other) return true;\n\n\tlet configProps = Object.getOwnPropertyNames(config);\n\tlet otherProps = Object.getOwnPropertyNames(other);\n\tif (configProps.length !== otherProps.length) return false;\n\n\tfor (let prop in config) {\n\t\tif (!other.hasOwnProperty(prop) || other[prop] !== config[prop]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * 获取容器下的水印 DOM 节点\n * @param {HTMLDocumentElement} container 水印所在容器的 DOM 节点\n * @returns 水印 DOM 节点\n */\nexport const getWatermarkByContainer = (container) => {\n  if (!container) return null;\n  \n  for(let child of container.childNodes.values()) {\n    if (child.className === '_watermark') {\n      return child;\n    }\n  }\n\n  return null;\n}\n","import Watermark from './src/index.js';\nexport default Watermark;\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Watermark","config","container","content","width","height","zIndex","font","textAlign","textBaseline","color","rotate","isFixed","dataUrl","styleString","wm","observer","constructor","this","setContainer","_watermarkInstance","other","configProps","getOwnPropertyNames","otherProps","length","isConfigEqual","error","console","log","init","includes","style","position","document","querySelector","generateDataUrl","generateStyleString","generateWatermark","observerContainer","canvas","createElement","setAttribute","ctx","getContext","fillStyle","translate","parseFloat","Math","PI","fillText","toDataURL","replaceAll","appendChild","MutationObserver","window","_watermark","child","childNodes","values","className","getWatermarkByContainer","getAttribute","hidden","newWm","observe","childList","attributes","subtree","disconnect","remove"],"sourceRoot":""}